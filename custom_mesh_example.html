
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User-Provided Mesh Example &#8212; OpenAeroStruct 2.2.1 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="More Examples" href="more_examples.html" />
    <link rel="prev" title="Aerostructural with Wingbox Walkthrough" href="aerostructural_wingbox_walkthrough.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="more_examples.html" title="More Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="aerostructural_wingbox_walkthrough.html" title="Aerostructural with Wingbox Walkthrough"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenAeroStruct 2.2.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">User-Provided Mesh Example</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="user-provided-mesh-example">
<span id="custom-mesh"></span><h1>User-Provided Mesh Example<a class="headerlink" href="#user-provided-mesh-example" title="Permalink to this headline">Â¶</a></h1>
<p>Here is an example script with a custom mesh provided as an array of coordinates.
This should help you understand how meshes are defined in OpenAeroStruct and how to create them for your own custom planform shapes.
This is an alternative to the helper-function approach described in <a class="reference internal" href="aero_walkthrough.html#aerodynamic-optimization-walkthrough"><span class="std std-ref">Aerodynamic Optimization Walkthrough</span></a>.</p>
<p>The following shows the portion of the example script in which the user provides the coordinates for the mesh.
This example is for a wing with a kink and two distinct trapezoidal segments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># CUSTOM MESH: Example mesh for a 2-segment wing with sweep</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="c1"># Planform specifications</span>
<span class="n">half_span</span> <span class="o">=</span> <span class="mf">12.0</span>               <span class="c1"># wing half-span in m</span>
<span class="n">kink_location</span> <span class="o">=</span> <span class="mf">4.0</span>            <span class="c1"># spanwise location of the kink in m</span>

<span class="n">root_chord</span> <span class="o">=</span> <span class="mf">6.0</span>               <span class="c1"># root chord in m</span>
<span class="n">kink_chord</span> <span class="o">=</span> <span class="mf">3.0</span>               <span class="c1"># kink chord in m</span>
<span class="n">tip_chord</span> <span class="o">=</span> <span class="mf">2.0</span>                <span class="c1"># tip chord in m</span>

<span class="n">inboard_LE_sweep</span> <span class="o">=</span> <span class="mf">10.</span>         <span class="c1"># inboard leading-edge sweep angle in deg</span>
<span class="n">outboard_LE_sweep</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.</span>       <span class="c1"># outboard leading-edge sweep angle in deg</span>

<span class="c1"># Mesh specifications</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">5</span>                         <span class="c1"># number of chordwise nodal points (should be odd)</span>
<span class="n">ny_outboard</span> <span class="o">=</span> <span class="mi">9</span>                <span class="c1"># number of spanwise nodal points for the outboard segment</span>
<span class="n">ny_inboard</span> <span class="o">=</span> <span class="mi">7</span>                 <span class="c1"># number of spanwise nodal points for the inboard segment</span>

<span class="c1"># Initialize the 3-D mesh object. Indexing: Chordwise, spanwise, then the 3-D coordinates.</span>
<span class="c1"># We use ny_inboard+ny_outboard-1 because the 2 segments share the nodes where they connect.</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="o">+</span><span class="n">ny_outboard</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># The form of this 3-D array can be confusing initially.</span>
<span class="c1"># For each node, we are providing the x, y, and z coordinates.</span>
<span class="c1"># x is streamwise, y is spanwise, and z is up.</span>
<span class="c1"># For example, the node for the leading edge at the tip would be specified as mesh[0, 0, :] = np.array([x, y, z]).</span>
<span class="c1"># And the node at the trailing edge at the root would be mesh[nx-1, ny-1, :] = np.array([x, y, z]).</span>
<span class="c1"># We only provide the right half of the wing here because we use symmetry.</span>
<span class="c1"># Print elements of the mesh to better understand the form.</span>

<span class="c1">####### THE Z-COORDINATES ######</span>
<span class="c1"># Assume no dihedral, so set the z-coordinate for all the points to 0.</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

<span class="c1">####### THE Y-COORDINATES ######</span>
<span class="c1"># Using uniform spacing for the spanwise locations of all the nodes within each of the two trapezoidal segments:</span>
<span class="c1"># Outboard</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="p">:</span><span class="n">ny_outboard</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">half_span</span><span class="p">,</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span>
<span class="c1"># Inboard</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="n">ny_outboard</span><span class="p">:</span><span class="n">ny_outboard</span><span class="o">+</span><span class="n">ny_inboard</span><span class="p">,</span>
     <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">kink_location</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1">###### THE X-COORDINATES ######</span>
<span class="c1"># Start with the leading edge and create some intermediate arrays that we will use</span>
<span class="n">x_LE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">array_for_inboard_leading_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">inboard_LE_sweep</span> <span class="o">/</span> <span class="mf">180.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="n">array_for_outboard_leading_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">half_span</span> <span class="o">-</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span>
    <span class="n">outboard_LE_sweep</span> <span class="o">/</span> <span class="mf">180.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ny_outboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">x_LE</span><span class="p">[:</span><span class="n">ny_inboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_inboard_leading_edge_x_coord</span>
<span class="n">x_LE</span><span class="p">[</span><span class="n">ny_inboard</span><span class="p">:</span> <span class="n">ny_inboard</span> <span class="o">+</span>
     <span class="n">ny_outboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># Then the trailing edge</span>
<span class="n">x_TE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">array_for_inboard_trailing_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">root_chord</span><span class="p">,</span> <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kink_chord</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)</span>

<span class="n">array_for_outboard_trailing_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kink_chord</span><span class="p">,</span> <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tip_chord</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span>

<span class="n">x_TE</span><span class="p">[:</span><span class="n">ny_inboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_inboard_trailing_edge_x_coord</span>
<span class="n">x_TE</span><span class="p">[</span><span class="n">ny_inboard</span><span class="p">:</span> <span class="n">ny_inboard</span> <span class="o">+</span>
     <span class="n">ny_outboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_outboard_trailing_edge_x_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># # Quick plot to check leading and trailing edge x-coords</span>
<span class="c1"># plt.plot(x_LE, np.arange(0, ny_inboard+ny_outboard-1), marker=&#39;*&#39;)</span>
<span class="c1"># plt.plot(x_TE, np.arange(0, ny_inboard+ny_outboard-1), marker=&#39;*&#39;)</span>
<span class="c1"># plt.show()</span>
<span class="c1"># exit()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="o">+</span><span class="n">ny_outboard</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">mesh</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x_LE</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x_TE</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">nx</span><span class="p">)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># END MESH</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>The following shows a visualization of the mesh.</p>
<img alt="_images/two_part_mesh.png" src="_images/two_part_mesh.png" />
<p>The complete script for the optimization is as follows.
Make sure you go through the <a class="reference internal" href="aerostructural_wingbox_walkthrough.html#aerostructural-with-wingbox-walkthrough"><span class="std std-ref">Aerostructural with Wingbox Walkthrough</span></a> before trying to understand this setup.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This example script can be used to run a multipoint aerostructural (w/ wingbox) optimization for a custom user-provided mesh.</span>

<span class="sd">The fuel burn from the cruise flight-point is the objective function and a 2.5g</span>
<span class="sd">maneuver flight-point is used for the structural sizing.</span>
<span class="sd">After running the optimization, use the &#39;plot_wingbox.py&#39; script in the utils/</span>
<span class="sd">directory (e.g., as &#39;python ../utils/plot_wingbox.py aerostruct.db&#39; if running</span>
<span class="sd">from this directory) to visualize the results.</span>
<span class="sd">&#39;plot_wingbox.py&#39; is still under development and will probably not work as it is for other types of cases for now.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">openaerostruct.geometry.utils</span> <span class="kn">import</span> <span class="n">generate_mesh</span>
<span class="kn">from</span> <span class="nn">openaerostruct.integration.aerostruct_groups</span> <span class="kn">import</span> <span class="n">AerostructGeometry</span><span class="p">,</span> <span class="n">AerostructPoint</span>
<span class="kn">from</span> <span class="nn">openaerostruct.structures.wingbox_fuel_vol_delta</span> <span class="kn">import</span> <span class="n">WingboxFuelVolDelta</span>
<span class="kn">from</span> <span class="nn">openaerostruct.utils.constants</span> <span class="kn">import</span> <span class="n">grav_constant</span>
<span class="kn">import</span> <span class="nn">openmdao.api</span> <span class="k">as</span> <span class="nn">om</span>


<span class="c1">#docs checkpoint 0</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># CUSTOM MESH: Example mesh for a 2-segment wing with sweep</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="c1"># Planform specifications</span>
<span class="n">half_span</span> <span class="o">=</span> <span class="mf">12.0</span>               <span class="c1"># wing half-span in m</span>
<span class="n">kink_location</span> <span class="o">=</span> <span class="mf">4.0</span>            <span class="c1"># spanwise location of the kink in m</span>

<span class="n">root_chord</span> <span class="o">=</span> <span class="mf">6.0</span>               <span class="c1"># root chord in m</span>
<span class="n">kink_chord</span> <span class="o">=</span> <span class="mf">3.0</span>               <span class="c1"># kink chord in m</span>
<span class="n">tip_chord</span> <span class="o">=</span> <span class="mf">2.0</span>                <span class="c1"># tip chord in m</span>

<span class="n">inboard_LE_sweep</span> <span class="o">=</span> <span class="mf">10.</span>         <span class="c1"># inboard leading-edge sweep angle in deg</span>
<span class="n">outboard_LE_sweep</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.</span>       <span class="c1"># outboard leading-edge sweep angle in deg</span>

<span class="c1"># Mesh specifications</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">5</span>                         <span class="c1"># number of chordwise nodal points (should be odd)</span>
<span class="n">ny_outboard</span> <span class="o">=</span> <span class="mi">9</span>                <span class="c1"># number of spanwise nodal points for the outboard segment</span>
<span class="n">ny_inboard</span> <span class="o">=</span> <span class="mi">7</span>                 <span class="c1"># number of spanwise nodal points for the inboard segment</span>

<span class="c1"># Initialize the 3-D mesh object. Indexing: Chordwise, spanwise, then the 3-D coordinates.</span>
<span class="c1"># We use ny_inboard+ny_outboard-1 because the 2 segments share the nodes where they connect.</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="o">+</span><span class="n">ny_outboard</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># The form of this 3-D array can be confusing initially.</span>
<span class="c1"># For each node, we are providing the x, y, and z coordinates.</span>
<span class="c1"># x is streamwise, y is spanwise, and z is up.</span>
<span class="c1"># For example, the node for the leading edge at the tip would be specified as mesh[0, 0, :] = np.array([x, y, z]).</span>
<span class="c1"># And the node at the trailing edge at the root would be mesh[nx-1, ny-1, :] = np.array([x, y, z]).</span>
<span class="c1"># We only provide the right half of the wing here because we use symmetry.</span>
<span class="c1"># Print elements of the mesh to better understand the form.</span>

<span class="c1">####### THE Z-COORDINATES ######</span>
<span class="c1"># Assume no dihedral, so set the z-coordinate for all the points to 0.</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

<span class="c1">####### THE Y-COORDINATES ######</span>
<span class="c1"># Using uniform spacing for the spanwise locations of all the nodes within each of the two trapezoidal segments:</span>
<span class="c1"># Outboard</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="p">:</span><span class="n">ny_outboard</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">half_span</span><span class="p">,</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span>
<span class="c1"># Inboard</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="n">ny_outboard</span><span class="p">:</span><span class="n">ny_outboard</span><span class="o">+</span><span class="n">ny_inboard</span><span class="p">,</span>
     <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">kink_location</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1">###### THE X-COORDINATES ######</span>
<span class="c1"># Start with the leading edge and create some intermediate arrays that we will use</span>
<span class="n">x_LE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">array_for_inboard_leading_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">inboard_LE_sweep</span> <span class="o">/</span> <span class="mf">180.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="n">array_for_outboard_leading_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">half_span</span> <span class="o">-</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span>
    <span class="n">outboard_LE_sweep</span> <span class="o">/</span> <span class="mf">180.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ny_outboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">x_LE</span><span class="p">[:</span><span class="n">ny_inboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_inboard_leading_edge_x_coord</span>
<span class="n">x_LE</span><span class="p">[</span><span class="n">ny_inboard</span><span class="p">:</span> <span class="n">ny_inboard</span> <span class="o">+</span>
     <span class="n">ny_outboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># Then the trailing edge</span>
<span class="n">x_TE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">array_for_inboard_trailing_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">root_chord</span><span class="p">,</span> <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kink_chord</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)</span>

<span class="n">array_for_outboard_trailing_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kink_chord</span><span class="p">,</span> <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tip_chord</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span>

<span class="n">x_TE</span><span class="p">[:</span><span class="n">ny_inboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_inboard_trailing_edge_x_coord</span>
<span class="n">x_TE</span><span class="p">[</span><span class="n">ny_inboard</span><span class="p">:</span> <span class="n">ny_inboard</span> <span class="o">+</span>
     <span class="n">ny_outboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_outboard_trailing_edge_x_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># # Quick plot to check leading and trailing edge x-coords</span>
<span class="c1"># plt.plot(x_LE, np.arange(0, ny_inboard+ny_outboard-1), marker=&#39;*&#39;)</span>
<span class="c1"># plt.plot(x_TE, np.arange(0, ny_inboard+ny_outboard-1), marker=&#39;*&#39;)</span>
<span class="c1"># plt.show()</span>
<span class="c1"># exit()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="o">+</span><span class="n">ny_outboard</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">mesh</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x_LE</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x_TE</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">nx</span><span class="p">)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># END MESH</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1">#docs checkpoint 1</span>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># On to the problem setup (this is the same setup used for the Q400 example)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="c1"># Provide coordinates for a portion of an airfoil for the wingbox cross-section as an nparray with dtype=complex (to work with the complex-step approximation for derivatives).</span>
<span class="c1"># These should be for an airfoil with the chord scaled to 1.</span>
<span class="c1"># We use the 10% to 60% portion of the NASA SC2-0612 airfoil for this case</span>
<span class="c1"># We use the coordinates available from airfoiltools.com. Using such a large number of coordinates is not necessary.</span>
<span class="c1"># The first and last x-coordinates of the upper and lower surfaces must be the same</span>

<span class="n">upper_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;complex128&#39;</span><span class="p">)</span>
<span class="n">lower_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;complex128&#39;</span><span class="p">)</span>
<span class="n">upper_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.0447</span><span class="p">,</span>  <span class="mf">0.046</span><span class="p">,</span>  <span class="mf">0.0472</span><span class="p">,</span>  <span class="mf">0.0484</span><span class="p">,</span>  <span class="mf">0.0495</span><span class="p">,</span>  <span class="mf">0.0505</span><span class="p">,</span>  <span class="mf">0.0514</span><span class="p">,</span>  <span class="mf">0.0523</span><span class="p">,</span>  <span class="mf">0.0531</span><span class="p">,</span>  <span class="mf">0.0538</span><span class="p">,</span> <span class="mf">0.0545</span><span class="p">,</span>  <span class="mf">0.0551</span><span class="p">,</span>  <span class="mf">0.0557</span><span class="p">,</span> <span class="mf">0.0563</span><span class="p">,</span>  <span class="mf">0.0568</span><span class="p">,</span> <span class="mf">0.0573</span><span class="p">,</span>  <span class="mf">0.0577</span><span class="p">,</span>  <span class="mf">0.0581</span><span class="p">,</span>  <span class="mf">0.0585</span><span class="p">,</span>  <span class="mf">0.0588</span><span class="p">,</span>  <span class="mf">0.0591</span><span class="p">,</span>  <span class="mf">0.0593</span><span class="p">,</span>  <span class="mf">0.0595</span><span class="p">,</span>  <span class="mf">0.0597</span><span class="p">,</span>  <span class="mf">0.0599</span><span class="p">,</span>  <span class="mf">0.06</span><span class="p">,</span>    <span class="mf">0.0601</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0601</span><span class="p">,</span>  <span class="mf">0.06</span><span class="p">,</span>    <span class="mf">0.0599</span><span class="p">,</span>  <span class="mf">0.0598</span><span class="p">,</span>  <span class="mf">0.0596</span><span class="p">,</span>  <span class="mf">0.0594</span><span class="p">,</span>  <span class="mf">0.0592</span><span class="p">,</span>  <span class="mf">0.0589</span><span class="p">,</span>  <span class="mf">0.0586</span><span class="p">,</span>  <span class="mf">0.0583</span><span class="p">,</span>  <span class="mf">0.058</span><span class="p">,</span>   <span class="mf">0.0576</span><span class="p">,</span>  <span class="mf">0.0572</span><span class="p">,</span>  <span class="mf">0.0568</span><span class="p">,</span>  <span class="mf">0.0563</span><span class="p">,</span>  <span class="mf">0.0558</span><span class="p">,</span>  <span class="mf">0.0553</span><span class="p">,</span>  <span class="mf">0.0547</span><span class="p">,</span>  <span class="mf">0.0541</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;complex128&#39;</span><span class="p">)</span>
<span class="n">lower_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.0447</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.046</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0473</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0485</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0496</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0506</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0515</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0524</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0532</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0547</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0554</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.056</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0565</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0575</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0579</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0583</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0586</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0589</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0592</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0594</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0595</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0594</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0592</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0589</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0586</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0582</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0578</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0573</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0567</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0561</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0554</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0546</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0538</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0529</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0519</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0509</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0497</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0485</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0472</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0458</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0444</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;complex128&#39;</span><span class="p">)</span>


<span class="n">surf_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># Wing definition</span>
            <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;wing&#39;</span><span class="p">,</span>         <span class="c1"># name of the surface</span>
            <span class="s1">&#39;symmetry&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>       <span class="c1"># if true, model one half of wing</span>
            <span class="s1">&#39;S_ref_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;wetted&#39;</span><span class="p">,</span> <span class="c1"># how we compute the wing area,</span>
                                     <span class="c1"># can be &#39;wetted&#39; or &#39;projected&#39;</span>
            <span class="s1">&#39;mesh&#39;</span> <span class="p">:</span> <span class="n">mesh</span><span class="p">,</span>
            <span class="s1">&#39;twist_cp&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">]),</span>

            <span class="s1">&#39;fem_model_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;wingbox&#39;</span><span class="p">,</span>
            <span class="s1">&#39;data_x_upper&#39;</span> <span class="p">:</span> <span class="n">upper_x</span><span class="p">,</span>
            <span class="s1">&#39;data_x_lower&#39;</span> <span class="p">:</span> <span class="n">lower_x</span><span class="p">,</span>
            <span class="s1">&#39;data_y_upper&#39;</span> <span class="p">:</span> <span class="n">upper_y</span><span class="p">,</span>
            <span class="s1">&#39;data_y_lower&#39;</span> <span class="p">:</span> <span class="n">lower_y</span><span class="p">,</span>

            <span class="s1">&#39;spar_thickness_cp&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">]),</span> <span class="c1"># [m]</span>
            <span class="s1">&#39;skin_thickness_cp&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">,</span> <span class="mf">0.010</span><span class="p">,</span> <span class="mf">0.012</span><span class="p">]),</span> <span class="c1"># [m]</span>

            <span class="s1">&#39;original_wingbox_airfoil_t_over_c&#39;</span> <span class="p">:</span> <span class="mf">0.12</span><span class="p">,</span>

            <span class="c1"># Aerodynamic deltas.</span>
            <span class="c1"># These CL0 and CD0 values are added to the CL and CD</span>
            <span class="c1"># obtained from aerodynamic analysis of the surface to get</span>
            <span class="c1"># the total CL and CD.</span>
            <span class="c1"># These CL0 and CD0 values do not vary wrt alpha.</span>
            <span class="c1"># They can be used to account for things that are not included, such as contributions from the fuselage, nacelles, tail surfaces, etc.</span>
            <span class="s1">&#39;CL0&#39;</span> <span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;CD0&#39;</span> <span class="p">:</span> <span class="mf">0.0142</span><span class="p">,</span>

            <span class="s1">&#39;with_viscous&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if true, compute viscous drag</span>
            <span class="s1">&#39;with_wave&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>     <span class="c1"># if true, compute wave drag</span>

            <span class="c1"># Airfoil properties for viscous drag calculation</span>
            <span class="s1">&#39;k_lam&#39;</span> <span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>         <span class="c1"># percentage of chord with laminar</span>
                                    <span class="c1"># flow, used for viscous drag</span>
            <span class="s1">&#39;c_max_t&#39;</span> <span class="p">:</span> <span class="o">.</span><span class="mi">38</span><span class="p">,</span>        <span class="c1"># chordwise location of maximum thickness</span>
            <span class="s1">&#39;t_over_c_cp&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]),</span>

            <span class="c1"># Structural values are based on aluminum 7075</span>
            <span class="s1">&#39;E&#39;</span> <span class="p">:</span> <span class="mf">73.1e9</span><span class="p">,</span>              <span class="c1"># [Pa] Young&#39;s modulus</span>
            <span class="s1">&#39;G&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mf">73.1e9</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mf">1.33</span><span class="p">),</span>     <span class="c1"># [Pa] shear modulus (calculated using E and the Poisson&#39;s ratio here)</span>
            <span class="s1">&#39;yield&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mf">420.e6</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># [Pa] allowable yield stress</span>
            <span class="s1">&#39;mrho&#39;</span> <span class="p">:</span> <span class="mf">2.78e3</span><span class="p">,</span>           <span class="c1"># [kg/m^3] material density</span>
            <span class="s1">&#39;strength_factor_for_upper_skin&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="c1"># the yield stress is multiplied by this factor for the upper skin</span>

            <span class="s1">&#39;wing_weight_ratio&#39;</span> <span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span>
            <span class="s1">&#39;exact_failure_constraint&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># if false, use KS function</span>

            <span class="s1">&#39;struct_weight_relief&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;distributed_fuel_weight&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

            <span class="s1">&#39;fuel_density&#39;</span> <span class="p">:</span> <span class="mf">803.</span><span class="p">,</span>      <span class="c1"># [kg/m^3] fuel density (only needed if the fuel-in-wing volume constraint is used)</span>
            <span class="s1">&#39;Wf_reserve&#39;</span> <span class="p">:</span><span class="mf">500.</span><span class="p">,</span>         <span class="c1"># [kg] reserve fuel mass</span>
            <span class="p">}</span>

<span class="n">surfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">surf_dict</span><span class="p">]</span>

<span class="c1"># Create the problem and assign the model group</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>

<span class="c1"># Add problem information as an independent variables component</span>
<span class="n">indep_var_comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">IndepVarComp</span><span class="p">()</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">310.95</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span> <span class="o">*</span> <span class="mf">340.294</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;alpha_maneuver&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mach_number&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]))</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;re&#39;</span><span class="p">,</span><span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">.</span><span class="mi">569</span><span class="o">*</span><span class="mf">310.95</span><span class="o">*.</span><span class="mi">5</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.56</span><span class="o">*</span><span class="mf">1e-5</span><span class="p">),</span> \
                          <span class="mf">1.225</span><span class="o">*</span><span class="mf">340.294</span><span class="o">*.</span><span class="mi">3</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.81206</span><span class="o">*</span><span class="mf">1e-5</span><span class="p">)]),</span>  <span class="n">units</span><span class="o">=</span><span class="s1">&#39;1/m&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">.</span><span class="mi">569</span><span class="p">,</span> <span class="mf">1.225</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m**3&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;CT&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.43</span><span class="o">/</span><span class="mi">3600</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;1/s&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">2e6</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;W0&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">25400</span> <span class="o">+</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s1">&#39;Wf_reserve&#39;</span><span class="p">],</span>  <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;speed_of_sound&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">310.95</span><span class="p">,</span> <span class="mf">340.294</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;load_factor&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]))</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;empty_cg&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;fuel_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">3000.</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s1">&#39;prob_vars&#39;</span><span class="p">,</span>
     <span class="n">indep_var_comp</span><span class="p">,</span>
     <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

<span class="c1"># Loop over each surface in the surfaces list</span>
<span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="p">:</span>

    <span class="c1"># Get the surface name and create a group to contain components</span>
    <span class="c1"># only for this surface</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="n">aerostruct_group</span> <span class="o">=</span> <span class="n">AerostructGeometry</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">)</span>

    <span class="c1"># Add group to the problem with the name of the surface.</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">aerostruct_group</span><span class="p">)</span>

<span class="c1"># Loop through and add a certain number of aerostruct points</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>

    <span class="n">point_name</span> <span class="o">=</span> <span class="s1">&#39;AS_point_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># Connect the parameters within the model for each aerostruct point</span>

    <span class="c1"># Create the aero point group and add it to the model</span>
    <span class="n">AS_point</span> <span class="o">=</span> <span class="n">AerostructPoint</span><span class="p">(</span><span class="n">surfaces</span><span class="o">=</span><span class="n">surfaces</span><span class="p">,</span> <span class="n">internally_connect_fuelburn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">point_name</span><span class="p">,</span> <span class="n">AS_point</span><span class="p">)</span>

    <span class="c1"># Connect flow properties to the analysis point</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.v&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;Mach_number&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.Mach_number&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;re&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.re&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.rho&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;CT&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.CT&#39;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.R&#39;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;W0&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.W0&#39;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;speed_of_sound&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.speed_of_sound&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;empty_cg&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.empty_cg&#39;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;load_factor&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.load_factor&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;fuel_mass&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.total_perf.L_equals_W.fuelburn&#39;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;fuel_mass&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.total_perf.CG.fuelburn&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="p">:</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s1">&#39;distributed_fuel_weight&#39;</span><span class="p">]:</span>
            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;load_factor&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.coupled.load_factor&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">com_name</span> <span class="o">=</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_perf.&#39;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.local_stiff_transformed&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.coupled.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.local_stiff_transformed&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.nodes&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.coupled.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.nodes&#39;</span><span class="p">)</span>

        <span class="c1"># Connect aerodynamic mesh to coupled group mesh</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.mesh&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.coupled.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.mesh&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s1">&#39;struct_weight_relief&#39;</span><span class="p">]:</span>
            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.element_mass&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.coupled.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.element_mass&#39;</span><span class="p">)</span>

        <span class="c1"># Connect performance calculation variables</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.nodes&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.cg_location&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;total_perf.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_cg_location&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.structural_mass&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;total_perf.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_structural_mass&#39;</span><span class="p">)</span>

        <span class="c1"># Connect wingbox properties to von Mises stress calcs</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.Qz&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;Qz&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.J&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;J&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.A_enc&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;A_enc&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.htop&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;htop&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.hbottom&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;hbottom&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.hfront&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;hfront&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.hrear&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;hrear&#39;</span><span class="p">)</span>

        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.spar_thickness&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;spar_thickness&#39;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.t_over_c&#39;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s1">&#39;t_over_c&#39;</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;AS_point_0&#39;</span> <span class="o">+</span> <span class="s1">&#39;.alpha&#39;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;alpha_maneuver&#39;</span><span class="p">,</span> <span class="s1">&#39;AS_point_1&#39;</span> <span class="o">+</span> <span class="s1">&#39;.alpha&#39;</span><span class="p">)</span>

<span class="c1"># Here we add the fuel volume constraint componenet to the model</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s1">&#39;fuel_vol_delta&#39;</span><span class="p">,</span> <span class="n">WingboxFuelVolDelta</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">))</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;wing.struct_setup.fuel_vols&#39;</span><span class="p">,</span> <span class="s1">&#39;fuel_vol_delta.fuel_vols&#39;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;AS_point_0.fuelburn&#39;</span><span class="p">,</span> <span class="s1">&#39;fuel_vol_delta.fuelburn&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s1">&#39;distributed_fuel_weight&#39;</span><span class="p">]:</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;wing.struct_setup.fuel_vols&#39;</span><span class="p">,</span> <span class="s1">&#39;AS_point_0.coupled.wing.struct_states.fuel_vols&#39;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;fuel_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;AS_point_0.coupled.wing.struct_states.fuel_mass&#39;</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;wing.struct_setup.fuel_vols&#39;</span><span class="p">,</span> <span class="s1">&#39;AS_point_1.coupled.wing.struct_states.fuel_vols&#39;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;fuel_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;AS_point_1.coupled.wing.struct_states.fuel_mass&#39;</span><span class="p">)</span>

<span class="n">comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span><span class="s1">&#39;fuel_diff = (fuel_mass - fuelburn) / fuelburn&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s1">&#39;fuel_diff&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span>
    <span class="n">promotes_inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fuel_mass&#39;</span><span class="p">],</span>
    <span class="n">promotes_outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fuel_diff&#39;</span><span class="p">])</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;AS_point_0.fuelburn&#39;</span><span class="p">,</span> <span class="s1">&#39;fuel_diff.fuelburn&#39;</span><span class="p">)</span>


<span class="c1">## Use these settings if you do not have pyOptSparse or SNOPT</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ScipyOptimizeDriver</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SLSQP&#39;</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-4</span>

<span class="n">recorder</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">SqliteRecorder</span><span class="p">(</span><span class="s2">&quot;aerostruct.db&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_recorder</span><span class="p">(</span><span class="n">recorder</span><span class="p">)</span>

<span class="c1"># We could also just use prob.driver.recording_options[&#39;includes&#39;]=[&#39;*&#39;] here, but for large meshes the database file becomes extremely large. So we just select the variables we need.</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s1">&#39;includes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;cg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_1.cg&#39;</span><span class="p">,</span> <span class="s1">&#39;AS_point_0.cg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_0.coupled.wing_loads.loads&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_1.coupled.wing_loads.loads&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_0.coupled.wing.normals&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_1.coupled.wing.normals&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_0.coupled.wing.widths&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_1.coupled.wing.widths&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_0.coupled.aero_states.wing_sec_forces&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_1.coupled.aero_states.wing_sec_forces&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_0.wing_perf.CL1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_1.wing_perf.CL1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_0.coupled.wing.S_ref&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_1.coupled.wing.S_ref&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wing.geometry.twist&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wing.mesh&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wing.skin_thickness&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wing.spar_thickness&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wing.t_over_c&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wing.structural_mass&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_0.wing_perf.vonmises&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_1.wing_perf.vonmises&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_0.coupled.wing.def_mesh&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS_point_1.coupled.wing.def_mesh&#39;</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s1">&#39;record_objectives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s1">&#39;record_constraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s1">&#39;record_desvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s1">&#39;record_inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s1">&#39;AS_point_0.fuelburn&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s1">&#39;wing.twist_cp&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">15.</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">15.</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s1">&#39;wing.spar_thickness_cp&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e2</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s1">&#39;wing.skin_thickness_cp&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e2</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s1">&#39;wing.geometry.t_over_c_cp&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s1">&#39;fuel_mass&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">2e5</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s1">&#39;alpha_maneuver&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">15.</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;AS_point_0.CL&#39;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;AS_point_1.L_equals_W&#39;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;AS_point_1.wing_perf.failure&#39;</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;fuel_vol_delta.fuel_vol_delta&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;fuel_diff&#39;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

<span class="c1"># Set up the problem</span>
<span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</pre></div>
</div>
<div class="cell border-box-sizing code_cell rendered"><div class="output_area"><pre>--------------------------------------------------------------------------
[[14841,1],0]: A high-performance Open MPI point-to-point messaging module
was unable to find any relevant network interfaces:

Module: OpenFabrics (openib)
  Host: travis-job-e97b0777-bb82-4404-88de-c02ccdfbc5d8

Another transport will be used instead, although this may result in
lower performance.
--------------------------------------------------------------------------
Unable to import petsc4py. Parallel processing unavailable.
Unable to import petsc4py. Parallel processing unavailable.</pre></div></div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># om.view_model(prob)</span>

<span class="c1"># prob.check_partials(form=&#39;central&#39;, compact_print=True)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">run_driver</span><span class="p">()</span>
</pre></div>
</div>
<div class="cell border-box-sizing code_cell rendered"><div class="output_area"><pre>==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 59474.4796 1
NL: NLBGS 1 ; 58887.5619 0.990131605
NL: NLBGS 2 ; 2135.6372 0.0359084638
NL: NLBGS 3 ; 129.822581 0.00218282836
NL: NLBGS 4 ; 0.0982497701 1.65196519e-06
NL: NLBGS 5 ; 0.00609244341 1.02437944e-07
NL: NLBGS 6 ; 1.22497549e-05 2.05966575e-10
NL: NLBGS 7 ; 5.66701695e-07 9.52848515e-12
NL: NLBGS 8 ; 9.62257994e-09 1.61793428e-13
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 63459.5268 1
NL: NLBGS 1 ; 54460.64 0.858194864
NL: NLBGS 2 ; 1819.7912 0.0286764067
NL: NLBGS 3 ; 101.992646 0.00160720779
NL: NLBGS 4 ; 0.0773689473 1.2191857e-06
NL: NLBGS 5 ; 0.00449093392 7.07684748e-08
NL: NLBGS 6 ; 4.35902628e-06 6.86898643e-11
NL: NLBGS 7 ; 1.03411407e-07 1.62956474e-12
NL: NLBGS 8 ; 3.48618256e-09 5.49355272e-14
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 4.93974465e-10 1
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 1.81346251e-10 1
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 12728.9662 1
NL: NLBGS 1 ; 11845.3274 0.930580475
NL: NLBGS 2 ; 1738.2115 0.13655559
NL: NLBGS 3 ; 258.506356 0.0203085114
NL: NLBGS 4 ; 0.643056228 5.05191243e-05
NL: NLBGS 5 ; 0.105488557 8.28728386e-06
NL: NLBGS 6 ; 0.00121596559 9.55274424e-08
NL: NLBGS 7 ; 0.000228835862 1.79775685e-08
NL: NLBGS 8 ; 5.68038261e-06 4.46256397e-10
NL: NLBGS 9 ; 1.176845e-06 9.24540909e-11
NL: NLBGS 10 ; 4.10041311e-08 3.22132453e-12
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 99452.7549 1
NL: NLBGS 1 ; 97692.4127 0.982299714
NL: NLBGS 2 ; 15055.6295 0.15138474
NL: NLBGS 3 ; 2312.63069 0.0232535609
NL: NLBGS 4 ; 25.8024669 0.000259444466
NL: NLBGS 5 ; 4.84446136 4.87111832e-05
NL: NLBGS 6 ; 0.146704324 1.47511574e-06
NL: NLBGS 7 ; 0.0317434491 3.19181195e-07
NL: NLBGS 8 ; 0.00140073749 1.40844513e-08
NL: NLBGS 9 ; 0.00034024968 3.42121925e-09
NL: NLBGS 10 ; 1.89589006e-05 1.90632231e-10
NL: NLBGS 11 ; 5.09703322e-06 5.12507997e-11
NL: NLBGS 12 ; 3.36469546e-07 3.38320991e-12
NL: NLBGS 13 ; 9.92097013e-08 9.97556089e-13
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 5549.21452 1
NL: NLBGS 1 ; 5487.53926 0.988885768
NL: NLBGS 2 ; 564.063588 0.101647465
NL: NLBGS 3 ; 62.7751443 0.0113124378
NL: NLBGS 4 ; 0.110153167 1.98502269e-05
NL: NLBGS 5 ; 0.0126939413 2.28752038e-06
NL: NLBGS 6 ; 4.07009365e-05 7.33454012e-09
NL: NLBGS 7 ; 4.54028438e-06 8.18185055e-10
NL: NLBGS 8 ; 6.31266979e-08 1.13757898e-11
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 11774.7881 1
NL: NLBGS 1 ; 10950.8534 0.930025517
NL: NLBGS 2 ; 1567.16465 0.133094934
NL: NLBGS 3 ; 163.221733 0.0138619678
NL: NLBGS 4 ; 0.247202348 2.09942078e-05
NL: NLBGS 5 ; 0.0240322789 2.04099461e-06
NL: NLBGS 6 ; 8.39846271e-05 7.13258078e-09
NL: NLBGS 7 ; 1.14467493e-05 9.72140577e-10
NL: NLBGS 8 ; 2.12217261e-07 1.80230217e-11
NL: NLBGS 9 ; 2.96563639e-08 2.5186325e-12
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 8633.52371 1
NL: NLBGS 1 ; 8673.29738 1.00460689
NL: NLBGS 2 ; 654.131012 0.0757664001
NL: NLBGS 3 ; 66.1718439 0.00766452333
NL: NLBGS 4 ; 0.176102547 2.03975286e-05
NL: NLBGS 5 ; 0.0192062915 2.22461791e-06
NL: NLBGS 6 ; 0.000135173375 1.56568024e-08
NL: NLBGS 7 ; 1.59063406e-05 1.84239264e-09
NL: NLBGS 8 ; 1.80279244e-07 2.08813053e-11
NL: NLBGS 9 ; 2.26182748e-08 2.61981961e-12
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 8633.52524 1
NL: NLBGS 1 ; 8067.25033 0.934409769
NL: NLBGS 2 ; 892.702347 0.103399518
NL: NLBGS 3 ; 87.4424266 0.0101282413
NL: NLBGS 4 ; 0.375901883 4.35397908e-05
NL: NLBGS 5 ; 0.0374915699 4.34255635e-06
NL: NLBGS 6 ; 0.00018876869 2.18646132e-08
NL: NLBGS 7 ; 1.83524472e-05 2.12571884e-09
NL: NLBGS 8 ; 5.21204059e-08 6.03697846e-12
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 7550.32338 1
NL: NLBGS 1 ; 7569.82468 1.00258284
NL: NLBGS 2 ; 525.220905 0.0695627032
NL: NLBGS 3 ; 52.9008423 0.00700643398
NL: NLBGS 4 ; 0.156947618 2.07868737e-05
NL: NLBGS 5 ; 0.0172643638 2.28657277e-06
NL: NLBGS 6 ; 0.000146731219 1.94337661e-08
NL: NLBGS 7 ; 1.75517932e-05 2.32464125e-09
NL: NLBGS 8 ; 2.47757092e-07 3.28141034e-11
NL: NLBGS 9 ; 3.19826856e-08 4.23593586e-12
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 7737.66878 1
NL: NLBGS 1 ; 7187.32345 0.928874529
NL: NLBGS 2 ; 551.522673 0.0712776275
NL: NLBGS 3 ; 54.7420102 0.00707474199
NL: NLBGS 4 ; 0.29549437 3.81890694e-05
NL: NLBGS 5 ; 0.030344756 3.92169229e-06
NL: NLBGS 6 ; 0.000217772857 2.81445049e-08
NL: NLBGS 7 ; 2.29959345e-05 2.97194609e-09
NL: NLBGS 8 ; 1.80047602e-07 2.32689725e-11
NL: NLBGS 9 ; 1.91044964e-08 2.46902483e-12
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 2019.19958 1
NL: NLBGS 1 ; 1982.67746 0.981912574
NL: NLBGS 2 ; 137.388069 0.0680408567
NL: NLBGS 3 ; 13.7899963 0.006829437
NL: NLBGS 4 ; 0.0405778856 2.00960252e-05
NL: NLBGS 5 ; 0.00445862248 2.20811381e-06
NL: NLBGS 6 ; 3.92988161e-05 1.94625714e-08
NL: NLBGS 7 ; 4.7074374e-06 2.33133834e-09
NL: NLBGS 8 ; 6.98498227e-08 3.45928275e-11
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 2319.2628 1
NL: NLBGS 1 ; 1949.67828 0.840645691
NL: NLBGS 2 ; 129.879719 0.0560004323
NL: NLBGS 3 ; 12.975061 0.00559447643
NL: NLBGS 4 ; 0.0769368743 3.31729869e-05
NL: NLBGS 5 ; 0.00800774652 3.45271201e-06
NL: NLBGS 6 ; 6.63488735e-05 2.86077427e-08
NL: NLBGS 7 ; 7.19745484e-06 3.10333734e-09
NL: NLBGS 8 ; 7.42339289e-08 3.20075538e-11
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 181.166291 1
NL: NLBGS 1 ; 179.412366 0.990318701
NL: NLBGS 2 ; 11.4380633 0.0631357148
NL: NLBGS 3 ; 1.14910476 0.00634281772
NL: NLBGS 4 ; 0.00364080733 2.00964943e-05
NL: NLBGS 5 ; 0.000400377369 2.20999926e-06
NL: NLBGS 6 ; 3.63520209e-06 2.00655545e-08
NL: NLBGS 7 ; 4.35702168e-07 2.40498476e-09
NL: NLBGS 8 ; 6.58863295e-09 3.63678746e-11
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 193.925191 1
NL: NLBGS 1 ; 166.708507 0.859653693
NL: NLBGS 2 ; 12.70745 0.0655275879
NL: NLBGS 3 ; 1.2632633 0.00651417843
NL: NLBGS 4 ; 0.00736874858 3.79978925e-05
NL: NLBGS 5 ; 0.000765629395 3.94806569e-06
NL: NLBGS 6 ; 6.50468373e-06 3.35422319e-08
NL: NLBGS 7 ; 7.06463538e-07 3.6429694e-09
NL: NLBGS 8 ; 7.73448934e-09 3.98838814e-11
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 1346.98162 1
NL: NLBGS 1 ; 1350.44719 1.00257284
NL: NLBGS 2 ; 90.2122147 0.066973605
NL: NLBGS 3 ; 8.97122007 0.00666023943
NL: NLBGS 4 ; 0.0271320212 2.01428296e-05
NL: NLBGS 5 ; 0.00295116501 2.19094676e-06
NL: NLBGS 6 ; 2.61174965e-05 1.93896458e-08
NL: NLBGS 7 ; 3.09599304e-06 2.29846719e-09
NL: NLBGS 8 ; 4.6038463e-08 3.41789839e-11
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 1374.20123 1
NL: NLBGS 1 ; 1276.0422 0.928570117
NL: NLBGS 2 ; 92.9566463 0.0676441298
NL: NLBGS 3 ; 9.17993996 0.00668020067
NL: NLBGS 4 ; 0.0548015757 3.9878858e-05
NL: NLBGS 5 ; 0.00565157529 4.1126257e-06
NL: NLBGS 6 ; 4.83679627e-05 3.5197147e-08
NL: NLBGS 7 ; 5.20639873e-06 3.78867274e-09
NL: NLBGS 8 ; 5.69015102e-08 4.14069708e-11
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 4690.59903 1
NL: NLBGS 1 ; 4709.57416 1.00404535
NL: NLBGS 2 ; 311.420729 0.0663925283
NL: NLBGS 3 ; 29.9609498 0.00638744639
NL: NLBGS 4 ; 0.0866780481 1.84790999e-05
NL: NLBGS 5 ; 0.00907884561 1.93554076e-06
NL: NLBGS 6 ; 7.53588366e-05 1.60659302e-08
NL: NLBGS 7 ; 8.58404135e-06 1.83005226e-09
NL: NLBGS 8 ; 1.20608239e-07 2.57127584e-11
NL: NLBGS 9 ; 1.48135809e-08 3.15814265e-12
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 4727.05179 1
NL: NLBGS 1 ; 4408.6817 0.932649333
NL: NLBGS 2 ; 326.886291 0.069152255
NL: NLBGS 3 ; 31.2476112 0.00661038054
NL: NLBGS 4 ; 0.190576445 4.03161322e-05
NL: NLBGS 5 ; 0.0189919937 4.01772489e-06
NL: NLBGS 6 ; 0.000163404816 3.4568019e-08
NL: NLBGS 7 ; 1.68994502e-05 3.57505077e-09
NL: NLBGS 8 ; 1.80566897e-07 3.81986288e-11
NL: NLBGS 9 ; 1.93280584e-08 4.08881883e-12
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 3386.93086 1
NL: NLBGS 1 ; 3401.45988 1.00428973
NL: NLBGS 2 ; 226.059392 0.0667446137
NL: NLBGS 3 ; 22.214925 0.00655901343
NL: NLBGS 4 ; 0.0626428997 1.84954764e-05
NL: NLBGS 5 ; 0.00670756464 1.98042562e-06
NL: NLBGS 6 ; 5.52389601e-05 1.63094443e-08
NL: NLBGS 7 ; 6.43101941e-06 1.89877493e-09
NL: NLBGS 8 ; 8.93202648e-08 2.63720366e-11
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 3412.22069 1
NL: NLBGS 1 ; 3183.90063 0.933087547
NL: NLBGS 2 ; 236.959749 0.0694444384
NL: NLBGS 3 ; 23.0601496 0.00675810613
NL: NLBGS 4 ; 0.130726336 3.83112195e-05
NL: NLBGS 5 ; 0.0131800872 3.86261278e-06
NL: NLBGS 6 ; 0.0001009037 2.95712704e-08
NL: NLBGS 7 ; 1.04901419e-05 3.07428589e-09
NL: NLBGS 8 ; 9.37958177e-08 2.74882038e-11
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 664.952499 1
NL: NLBGS 1 ; 666.110462 1.00174142
NL: NLBGS 2 ; 44.363362 0.0667165882
NL: NLBGS 3 ; 4.36122234 0.00655869757
NL: NLBGS 4 ; 0.0128759351 1.93636915e-05
NL: NLBGS 5 ; 0.0013825221 2.07912911e-06
NL: NLBGS 6 ; 1.18794201e-05 1.78650657e-08
NL: NLBGS 7 ; 1.38854583e-06 2.08818801e-09
NL: NLBGS 8 ; 2.00418986e-08 3.01403463e-11
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 695.196908 1
NL: NLBGS 1 ; 642.521678 0.924229769
NL: NLBGS 2 ; 45.7418535 0.0657969749
NL: NLBGS 3 ; 4.45626915 0.00641008194
NL: NLBGS 4 ; 0.0256838954 3.69447779e-05
NL: NLBGS 5 ; 0.00260505478 3.7472186e-06
NL: NLBGS 6 ; 2.10827807e-05 3.03263441e-08
NL: NLBGS 7 ; 2.22213455e-06 3.19641029e-09
NL: NLBGS 8 ; 2.21907736e-08 3.1920127e-11
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 638.568332 1
NL: NLBGS 1 ; 642.418695 1.00602968
NL: NLBGS 2 ; 41.660318 0.065240188
NL: NLBGS 3 ; 4.03775167 0.00632313172
NL: NLBGS 4 ; 0.0112335682 1.75918028e-05
NL: NLBGS 5 ; 0.00118764805 1.85986054e-06
NL: NLBGS 6 ; 9.86454317e-06 1.54479054e-08
NL: NLBGS 7 ; 1.13560728e-06 1.77836454e-09
NL: NLBGS 8 ; 1.60081605e-08 2.50688293e-11
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 618.70043 1
NL: NLBGS 1 ; 583.285798 0.942759644
NL: NLBGS 2 ; 43.9810254 0.07108614
NL: NLBGS 3 ; 4.23274982 0.00684135587
NL: NLBGS 4 ; 0.0245661107 3.97059861e-05
NL: NLBGS 5 ; 0.00246024395 3.9764704e-06
NL: NLBGS 6 ; 2.00238319e-05 3.23643413e-08
NL: NLBGS 7 ; 2.08160837e-06 3.36448508e-09
NL: NLBGS 8 ; 2.10449695e-08 3.4014797e-11
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 2902.17937 1
NL: NLBGS 1 ; 2921.54078 1.00667133
NL: NLBGS 2 ; 182.129731 0.0627561938
NL: NLBGS 3 ; 16.7155965 0.00575967034
NL: NLBGS 4 ; 0.0442969271 1.52633319e-05
NL: NLBGS 5 ; 0.00442503639 1.52472877e-06
NL: NLBGS 6 ; 3.45934325e-05 1.1919812e-08
NL: NLBGS 7 ; 3.75948662e-06 1.29540119e-09
NL: NLBGS 8 ; 5.02222836e-08 1.7305024e-11
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 2795.76571 1
NL: NLBGS 1 ; 2640.64442 0.944515633
NL: NLBGS 2 ; 193.324976 0.0691492049
NL: NLBGS 3 ; 17.6431835 0.00631068024
NL: NLBGS 4 ; 0.102193667 3.65530155e-05
NL: NLBGS 5 ; 0.00970967889 3.47299448e-06
NL: NLBGS 6 ; 7.89252904e-05 2.82302948e-08
NL: NLBGS 7 ; 7.77115427e-06 2.7796157e-09
NL: NLBGS 8 ; 7.79553145e-08 2.78833502e-11
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 6618.40207 1
NL: NLBGS 1 ; 6676.98507 1.00885153
NL: NLBGS 2 ; 379.832502 0.0573903637
NL: NLBGS 3 ; 30.7227688 0.00464202212
NL: NLBGS 4 ; 0.0720562753 1.08872617e-05
NL: NLBGS 5 ; 0.00629777031 9.51554505e-07
NL: NLBGS 6 ; 4.15244028e-05 6.27408284e-09
NL: NLBGS 7 ; 3.93561781e-06 5.94647736e-10
NL: NLBGS 8 ; 4.46794392e-08 6.7507895e-12
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 6233.43856 1
NL: NLBGS 1 ; 5935.22915 0.952159726
NL: NLBGS 2 ; 417.211289 0.0669311625
NL: NLBGS 3 ; 33.5786006 0.00538685033
NL: NLBGS 4 ; 0.187951191 3.01520885e-05
NL: NLBGS 5 ; 0.015766637 2.52936431e-06
NL: NLBGS 6 ; 0.000124566763 1.99836353e-08
NL: NLBGS 7 ; 1.07802003e-05 1.7294147e-09
NL: NLBGS 8 ; 1.02737965e-07 1.64817483e-11
NL: NLBGS 9 ; 9.16906546e-09 1.47094824e-12
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 2011.70472 1
NL: NLBGS 1 ; 2031.98561 1.01008144
NL: NLBGS 2 ; 110.395442 0.0548765637
NL: NLBGS 3 ; 8.47234039 0.00421152284
NL: NLBGS 4 ; 0.0169225721 8.41205568e-06
NL: NLBGS 5 ; 0.00139188189 6.91891742e-07
NL: NLBGS 6 ; 7.67458849e-06 3.81496768e-09
NL: NLBGS 7 ; 6.83414586e-07 3.39719134e-10
NL: NLBGS 8 ; 6.63172775e-09 3.29657115e-12
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 1832.79637 1
NL: NLBGS 1 ; 1736.83128 0.94764007
NL: NLBGS 2 ; 136.789456 0.0746342901
NL: NLBGS 3 ; 10.3604484 0.00565280932
NL: NLBGS 4 ; 0.0499278124 2.72413309e-05
NL: NLBGS 5 ; 0.00392673129 2.14248094e-06
NL: NLBGS 6 ; 2.68832193e-05 1.46678702e-08
NL: NLBGS 7 ; 2.16181916e-06 1.17951955e-09
NL: NLBGS 8 ; 1.70394351e-08 9.29696032e-12
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 1546.19809 1
NL: NLBGS 1 ; 1564.21047 1.01164946
NL: NLBGS 2 ; 82.9142575 0.0536246021
NL: NLBGS 3 ; 6.16715603 0.00398859374
NL: NLBGS 4 ; 0.0122203203 7.90346354e-06
NL: NLBGS 5 ; 0.000971537585 6.2833966e-07
NL: NLBGS 6 ; 5.08123004e-06 3.28627364e-09
NL: NLBGS 7 ; 4.36653132e-07 2.82404391e-10
NL: NLBGS 8 ; 4.01187661e-09 2.59467181e-12
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 1410.10007 1
NL: NLBGS 1 ; 1353.01112 0.959514254
NL: NLBGS 2 ; 97.7126955 0.069294866
NL: NLBGS 3 ; 7.19414627 0.0051018693
NL: NLBGS 4 ; 0.0359526505 2.54965241e-05
NL: NLBGS 5 ; 0.00274713661 1.94818556e-06
NL: NLBGS 6 ; 1.9111062e-05 1.35529828e-08
NL: NLBGS 7 ; 1.49050968e-06 1.05702404e-09
NL: NLBGS 8 ; 1.17291305e-08 8.31794189e-12
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 820.255404 1
NL: NLBGS 1 ; 830.008515 1.01189033
NL: NLBGS 2 ; 43.3890401 0.0528969878
NL: NLBGS 3 ; 3.17149772 0.00386647586
NL: NLBGS 4 ; 0.00608191799 7.41466372e-06
NL: NLBGS 5 ; 0.000473940002 5.77795647e-07
NL: NLBGS 6 ; 2.3490626e-06 2.8638185e-09
NL: NLBGS 7 ; 1.97636952e-07 2.40945626e-10
NL: NLBGS 8 ; 1.71462307e-09 2.09035266e-12
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 745.256726 1
NL: NLBGS 1 ; 714.640542 0.958918608
NL: NLBGS 2 ; 51.9170206 0.0696632701
NL: NLBGS 3 ; 3.75164968 0.00503403666
NL: NLBGS 4 ; 0.0183097105 2.45683264e-05
NL: NLBGS 5 ; 0.00137267184 1.84187783e-06
NL: NLBGS 6 ; 9.34155637e-06 1.25346824e-08
NL: NLBGS 7 ; 7.13748505e-07 9.57721655e-10
NL: NLBGS 8 ; 5.48225463e-09 7.35619611e-12
NL: NLBGS Converged

==================
AS_point_0.coupled
==================
NL: NLBGS 0 ; 16.3027634 1
NL: NLBGS 1 ; 16.4647163 1.00993408
NL: NLBGS 2 ; 0.800288446 0.0490891285
NL: NLBGS 3 ; 0.0580589038 0.00356129219
NL: NLBGS 4 ; 8.83386624e-05 5.41863121e-06
NL: NLBGS 5 ; 6.78272327e-06 4.16047459e-07
NL: NLBGS 6 ; 2.81955602e-08 1.72949576e-09
NL: NLBGS Converged

==================
AS_point_1.coupled
==================
NL: NLBGS 0 ; 15.3413428 1
NL: NLBGS 1 ; 14.1187742 0.92030889
NL: NLBGS 2 ; 1.09179565 0.0711668896
NL: NLBGS 3 ; 0.0774024666 0.00504535147
NL: NLBGS 4 ; 0.000297105675 1.93663409e-05
NL: NLBGS 5 ; 2.17614933e-05 1.41848686e-06
NL: NLBGS 6 ; 1.20607649e-07 7.86160965e-09
NL: NLBGS 7 ; 8.96305954e-09 5.84242178e-10
NL: NLBGS Converged
/home/travis/build/mdolab/OpenAeroStruct/openaerostruct/structures/compute_nodes.py:53: ComplexWarning: Casting complex values to real discards the imaginary part
  data[:n] = 1 - w
/home/travis/build/mdolab/OpenAeroStruct/openaerostruct/structures/compute_nodes.py:54: ComplexWarning: Casting complex values to real discards the imaginary part
  data[n:] = w
/home/travis/miniconda/lib/python3.7/site-packages/openmdao/utils/general_utils.py:281: ComplexWarning: Casting complex values to real discards the imaginary part
  value = np.atleast_1d(value).astype(np.float64)
/home/travis/build/mdolab/OpenAeroStruct/openaerostruct/transfer/load_transfer.py:51: ComplexWarning: Casting complex values to real discards the imaginary part
  self.fem_origin = np.float(fem_origin)
/home/travis/build/mdolab/OpenAeroStruct/openaerostruct/structures/wingbox_geometry.py:82: ComplexWarning: Casting complex values to real discards the imaginary part
  fem_chords[ielem] = fem_chords[ielem] * cos_theta_fe_sweep
/home/travis/miniconda/lib/python3.7/site-packages/openmdao/vectors/vector.py:549: ComplexWarning: Casting complex values to real discards the imaginary part
  self._views[abs_name][idxs] = value
Optimization terminated successfully    (Exit mode 0)
            Current function value: [0.0267593]
            Iterations: 16
            Function evaluations: 18
            Gradient evaluations: 16
Optimization Complete
-----------------------------------</pre></div></div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># prob.run_model()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The fuel burn value is&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;AS_point_0.fuelburn&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;[kg]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell border-box-sizing code_cell rendered"><div class="output_area"><pre>The fuel burn value is 2675.929750376661 [kg]</pre></div></div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The wingbox mass (excluding the wing_weight_ratio) is&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wing.structural_mass&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">surf_dict</span><span class="p">[</span><span class="s1">&#39;wing_weight_ratio&#39;</span><span class="p">],</span> <span class="s1">&#39;[kg]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell border-box-sizing code_cell rendered"><div class="output_area"><pre>The wingbox mass (excluding the wing_weight_ratio) is 1122.0430218769484 [kg]</pre></div></div><p>There is plenty of room for improvement.
A finer mesh and a tighter optimization tolerance should be used.</p>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_example.html">Quick Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="aero_walkthrough.html">Aerodynamic Optimization Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="struct_example.html">Structural Optimization Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="aerostructural_walkthrough.html">Aerostructural Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="aerostructural_wingbox_walkthrough.html">Aerostructural with Wingbox Walkthrough</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User-Provided Mesh Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="more_examples.html">More Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="specialty_topics.html">Specialty Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="v1_v2_conversion.html">OpenAeroStruct v1 to v2 Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_contribute.html">How to Contribute to OpenAeroStruct</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_srcdocs/index.html">Source Docs</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="more_examples.html" title="More Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="aerostructural_wingbox_walkthrough.html" title="Aerostructural with Wingbox Walkthrough"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenAeroStruct 2.2.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">User-Provided Mesh Example</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, John Jasa, Dr. John Hwang, Justin S. Gray.
      Last updated on Aug 24, 2020.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>